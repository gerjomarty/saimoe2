<% cache vm.dependencies do %>
    <div class="final-matches-view-model">
        <% if vm.victory_image_tag %>
            <div class="victory-image">
                <%= vm.victory_image_tag %>
            </div>
            <hr />
        <% end %>

        <div class="final">
            <%= render partial: 'view_models/match',
                       object: vm.grand_final_view_model,
                       as: :vm %>
        </div>

        <div class="cb"></div>

        <div class="quarter-final left">
            <%= render partial: 'view_models/match',
                       object: vm.left_quarter_final_view_models[0],
                       as: :vm %>
            <div class="cb"></div>
            <%= render partial: 'view_models/match',
                       object: vm.left_quarter_final_view_models[1],
                       as: :vm %>
        </div>
        <div class="semi-final left">
            <%= render partial: 'view_models/match',
                       object: vm.left_semi_final_view_model,
                       as: :vm %>
        </div>
        <div class="semi-final right">
            <%= render partial: 'view_models/match',
                       object: vm.right_semi_final_view_model,
                       as: :vm %>
        </div>
        <div class="quarter-final right">
            <%= render partial: 'view_models/match',
                       object: vm.right_quarter_final_view_models[0],
                       as: :vm %>
            <div class="cb"></div>
            <%= render partial: 'view_models/match',
                       object: vm.right_quarter_final_view_models[1],
                       as: :vm %>
        </div>

        <div class="cb"></div>

        <% [[:last_16, vm.last_16_view_models],
            [:last_32, vm.last_32_view_models]].each do |stage, view_models| %>
            <% if view_models.any? %>
                <div class="cb"></div>
                <hr />
                <h3><%= MatchInfo.pretty_stage(stage) %></h3>
                <div class="last-x">
                    <% view_models.each do |matches_block| %>
                        <div class="last-x-block">
                            <%= render partial: 'view_models/match',
                                       object: matches_block[0],
                                       as: :vm %>
                            <div class="cb"></div>
                            <%= render partial: 'view_models/match',
                                       object: matches_block[1],
                                       as: :vm %>
                        </div>
                    <% end %>
                </div>
            <% end %>
        <% end %>
    </div>
<% end %>
