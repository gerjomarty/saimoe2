<% raise ArgumentError, "locals not defined" unless stage && match && current_match_entry %>
<button class="button-popover btn <%= button_type_for(current_match_entry) %>" data-original-title="<%= pretty_match(match) %>">
  <%= pretty_stage(stage) %>
</button>
<div class="button-popover-content" style="display: none;">
  <table class="table table-condensed">
    <% if match.is_finished? %>
        <thead>
        <tr>
          <th>votes</th>
          <th>%&nbsp;share</th>
          <th></th>
        </tr>
        </thead>
        <tbody>
        <% match.match_entries.ordered_by_votes.each do |me| %>
            <% is_current = (me == current_match_entry) %>
            <tr>
              <td<%= " style=\"font-weight: bold;\"".html_safe if is_current %>><%= me.number_of_votes %></td>
              <td<%= " style=\"font-weight: bold;\"".html_safe if is_current %>><%= format_percent me.vote_share %></td>
              <td<%= " style=\"font-weight: bold;\"".html_safe if is_current %>><%= me.character_name %></td>
            </tr>
        <% end %>
        </tbody>
    <% else %>
        <thead>
        <tr>
          <th></th>
        </tr>
        </thead>
        <tbody>
        <% match.match_entries.ordered_by_position.each do |me| %>
            <% is_current = (me == current_match_entry) %>
            <tr>
              <td<%= " style=\"font-weight: bold;\"".html_safe if is_current %>><%= me.character_name %></td>
            </tr>
        <% end %>
        </tbody>
    <% end %>
  </table>
</div>